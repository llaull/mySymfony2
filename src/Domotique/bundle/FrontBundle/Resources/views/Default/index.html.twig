{% set pageTitle = 'domobox' %}
{% extends "CommunUserBundle:Default:body.html.twig" %}
{% block content %}
    {% stylesheets
    '@DomotiquebundleFrontBundle/Resources/public/js/tinycolorpicker/tinycolorpicker.css' %}
    <link rel="stylesheet" href="{{ asset_url }}"/>
    {% endstylesheets %}

    Hello {{ name }}!

    {% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
        {{ 'layout.logged_in_as'|trans({'%username%': app.user.username}, 'FOSUserBundle') }}
    {% endif %}

    <div id="colorPicker" class="TinyColorConteneur">
        <a class="color">
            <div class="colorInner"></div>
        </a>

        <div class="track" style="background:#EFEFEF url({{ asset('text-color.png') }}) no-repeat 50% 50%; "></div>
        <ul class="dropdown">
            <li></li>
        </ul>
        <input type="hidden" class="colorInput" id="colorInput"/>
        <input type="hidden" class="moduleID" value="8"/>
    </div>


{% endblock %}
{% block javascripts %}

    {% javascripts
    '@DomotiquebundleFrontBundle/Resources/public/js/tinycolorpicker/jquery.tinycolorpicker.js' %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}


    <script type="text/javascript">
        $(document).ready(function () {
            var $box = $('.TinyColorConteneur');
            var box = $box.tinycolorpicker();

            $box.bind("change", function () {

                var selectedValue = $(this).find(".colorInput").val();
                var moduleID = $(this).find(".moduleID").val();
                var path = $(this).find(".path").val();

                var dataJson = '[' + '{"module":"' + moduleID + '"},' + '{"path":"color"},' + '{"color":"' + selectedValue + '"}' + ']';
               // ajax('{{ path ('domotique_module_set_color') }}', dataJson);
                ajax('{{ path ('domotique_module_set_curl') }}', dataJson);


            });

            /*
             function Ajax
             */
            function ajax($route, $dataJson) {

                $.ajax({
                    type: "POST",
                    dataType: 'json',
                    url: $route,
                    data: {
                        restUrl: "127.0.0.1/index.php?s=lnlblb",
                        method: 'GET',
                        params: {
                            action: "getFriendList"
                        }
                    },
                    success: function (data, textStatus, jqXHR) {
                        console.log(data + " <-> " + textStatus + " <-> " + jqXHR);
                    }
                });

//                $.ajax({
//                    data: 'data=' + $dataJson,
//                    cache: false,
//                    type: 'POST',
//                    url: $route,
//                    success: function () {
//                    }
//                });
            }
        });
    </script>
{% endblock %}
